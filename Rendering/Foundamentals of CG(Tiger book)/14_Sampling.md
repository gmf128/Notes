# 14.Sampling

## 14.3 Monte Carlo Integration

在本节中，我们将概述确定积分的基本蒙特卡洛解法。然后，这些技术会被直接应用于某些积分问题。 

给定$f: S\to \mathbb{R}$以及随机变量$x\sim p$
$$
E(f(x)) = \int_{x\in S}f(x)p(x)d\mu \approx \frac{1}{N}\sum_i^Nf(x_i)\tag{14.4}
$$
式14.4的右侧是源于统计学原理：独立等分布地取N个样本点x_i，那么当N的数量足够大，那么通过14.4计算出的值就越逼近积分的实际值。

**大数定律Law of Large Numbers:** 
$$
P[E(x) = \lim_{N\to \infty}\frac{1}{N}\sum_i^Nf(x_i)] = 1
$$
那么对于一般函数的积分：
$$
\int_{x\in S}g(x)d\mu\approx \frac{1}{N}\sum_i^N\frac{g(x_i)}{p(x_i)}\tag{14.5}
$$
为了使14.5有意义，当g不为0时，p必须为正。

为了获得一个好的估计值，我们希望获得尽可能多的样本，并且希望 g/p 的方差较低（g 和 p 应该具有类似的形状）。聪明地选择 p 被称为重要性采样，**因为如果 p 在 g 处较大，那么重要区域将有更多的样本**。方程（14.4）还显示了蒙特卡洛积分的一个基本问题：收益递减。**因为估计值的方差与 1/N 成正比，标准差与 $1/\sqrt{N}$ 成正比。由于估计值的误差表现与标准差类似**，我们需要将 N 增加四倍才能将误差减少一半。 

Why?

减少方差的另一种方法是将积分的定义域 S 分割为几个较小的域 Si，并将积分评估为对 Si 上的积分之和。**这被称为分层抽样( stratified sampling)**，即像像素采样（第4章）中使用的技术。通常在每个 Si（密度为 pi）中只取一个样本，在这种情况下，估计值的方差为：