# Chapter 14 Volumetric and Translucency Rendering

Translucency: adj. 半透明的

**参与介质(participating media)**: 参与介质这个名词用来描述充满颗粒的介质。正如名字所示，它们是参与光传输的介质，也就是通过散射或吸收影响通过它们的光线。在渲染虚拟世界时，我们通常关注固体表面，它们既简单又复杂。这些表面表现为不透明，因为它们是由光线反射至密集的参与介质上形成的，例如使用BRDF对典型介电体或金属进行建模。较不密集的众所周知的介质有水、雾、蒸汽甚至空气，由稀疏的分子组成。根据介质的组成，它会以不同方式与光线交互，光线透过介质并反射于其颗粒上，这通常被称为光散射事件。颗粒的密度可以是均匀的（均匀分布），比如空气或水的情况。也可以是非均匀的（非均匀分布，空间位置变化），比如云或蒸汽的情况。一些常用作固体表面进行渲染的密集材料具有高水平的光散射，例如皮肤或蜡烛蜡。如9.1节所示，漫反射表面着色模型是微观级别上的光散射结果。一切都在发生散射。 

## 14.1 Light Scatting Theory

### 14.1.1 Participating Media Material

![1688020643586](Volumetric%20and%20Translucency%20Rendering.assets/1688020643586.png)

当光穿越介质时，一共有 四种物理现象可能导致radiance发生改变，如上图所示，它们分别是：

1. **Absorption 吸收**：光子被介质吸收，转换为热能或其他形式的能量

   与之相关的物理量：$\sigma_{a}$: Absorption\ coefficient​ 吸收系数，是波长的函数

2. **Out-scattering 外散射**：光子与介质粒子发生碰撞，发生向外的散射。

   与之相关的物理量：1. phase function $p$:描述了外散射光线的分布。

   > 相位函数（Phase Function）是描述光线在散射过程中改变传播方向的函数。它定义了从特定方向入射的光线与散射后出射到不同方向的光线之间的关系。相位函数通常用于描述光线在与小颗粒或微粒发生散射时的行为，例如大气中的气溶胶或云中的水滴。
   >
   > 相位函数通常与散射角度有关，它描述了光线在特定散射角度上的分布情况。不同类型的散射过程和介质会具有不同的相位函数。例如，远程散射（如雷利散射）和近场散射（如霍姆法克散射）有不同的相位函数形式。
   >
   > 相位函数在计算机图形学和光学模拟中很重要，尤其是在渲染参与介质、光传输和全局光照模型中。它对于模拟和模型化光线与介质相互作用的方式至关重要，以产生逼真的光照效果和视觉效果。

   2. $\sigma_s$:散射系数，同样与波长相关

3. **Emission 激发**：光线在通过高温时可能被激发，比如黑体热辐射。

4. **In-scattering 内散射**： 任何方向的光子在经过颗粒反射后，可以散射到当前的光路径中，并对最终的辐射产生贡献。从给定方向入射的散射光量还取决于该光方向的相位函数 p 

   与之相关的物理量：$\sigma_s, p$

**Albedo 的定义：**
$$
\rho = \frac{\sigma_s}{\sigma_s + \sigma_a} = \frac{\sigma_s}{\sigma_t}
$$
在计算机图形学中，albedo（反射率）是指光线照射到物体表面后被反射回来的能量的比例。它表示了物体表面对各个入射光波长的反射能力。具体来说，albedo表示物体在不考虑阴影、透射、散射等因素的情况下，对入射光进行漫反射的能力。

Albedo通常用一个在0到1之间取值的标量或颜色来表示。对于白色物体，其albedo值为1，表示它能够完全反射所有入射光；对于黑色物体，其albedo值为0，表示它无法反射任何光。其他颜色的物体的albedo值介于0和1之间，反映了它们对不同波长光的反射程度。

在渲染过程中，albedo值是计算光照模型的重要输入之一。通过将入射光与物体表面的albedo进行乘法运算，可以确定物体在不同光照条件下的表面颜色。此外，由于albedo是表面本身的属性，它在材质编辑和贴图设计中也扮演着重要的角色。

**在以往的渲染中，由于我们忽视了介质的存在·，因此可以假设radiance在传播过程中保持不变，即$L_i(c, -v) = L_o(p, v)$**

然而，在考虑介质的存在后，这种假设不再能够成立。

$$
L_i(\mathbf{c},-\mathbf{v}) = T_r(\mathbf{c},\mathbf{p})L_o(\mathbf{p}, \mathbf{v})+\int_0^{||\mathbf{p}-\mathbf{c}||}T_r(\mathbf{c}, \mathbf{c-v}t)L_{scat}(\mathbf{c}-\mathbf{v}t,\mathbf{v})\sigma_sdt
$$
![1695119297799](Volumetric%20and%20Translucency%20Rendering.assets/1695119297799.png)

### 14.1.2 Transmittance

$$
T(x_a, x_b) = \exp(-\int_{x=x_a}^{x_b}\sigma_t(x)||dx||)
$$

注意$\sigma_t$也是一个spectrum，即它是RGB值。

 For instance, if $σ_t = (0.5, 1, 2)$ in RGB, then the light coming through depth d = 1 meter will be $T_r = e^ {−dσ_t} ≈ (0.61, 0.37, 0.14).$ 